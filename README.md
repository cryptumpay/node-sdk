# CryptumPay Node.js SDK

[![npm version](https://img.shields.io/npm/v/@cryptumpay/node-sdk.svg)](https://www.npmjs.com/package/@cryptumpay/node-sdk)
[![npm downloads](https://img.shields.io/npm/dm/@cryptumpay/node-sdk.svg)](https://www.npmjs.com/package/@cryptumpay/node-sdk)
[![license](https://img.shields.io/npm/l/@cryptumpay/node-sdk.svg)](https://github.com/cryptumpay/node-sdk/blob/main/LICENSE)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.0+-blue.svg)](https://www.typescriptlang.org/)

Official Node.js SDK for CryptumPay API with built-in request signing and full TypeScript support.

---

## TL;DR

- SDK is **server-side only**
- You create an order on your backend
- CryptumPay returns **CryptumPay Order ID** (`response.data.id`)
- This ID is used by the widget or payment links
- Payment is considered successful **only when order status is `PAID`**

---

## Installation

```bash
npm install @cryptumpay/node-sdk
```

or

```bash
yarn add @cryptumpay/node-sdk
```

---

## Requirements

- Node.js >= 18.0.0
- TypeScript >= 5.0 (optional but recommended)

---

## Quick Start

```ts
import { CryptumPayClient, CryptumPaySigner } from '@cryptumpay/node-sdk';

const client = new CryptumPayClient(
  new CryptumPaySigner(
    process.env.CRYPTUMPAY_API_KEY!,
    process.env.CRYPTUMPAY_API_SECRET!
  )
);
```

> âš ï¸ Never expose API keys in frontend or public repositories.

---

## Order ID Terminology (IMPORTANT)

There are **two different order identifiers** involved in the integration.

### Merchant Order ID

- Generated by **your system**
- Any format (e.g. `order-12345`)
- Optional
- Passed via `projectDataOrderId`
- Stored only as metadata

### CryptumPay Order ID

- Generated by **CryptumPay**
- Returned by the SDK as `response.data.id`
- **Required** for widget and payment links
- Used to fetch order data and track payment status

> âš ï¸ Modal-View Widget **accepts only CryptumPay Order ID**.

---

## Integration Methods

CryptumPay supports two integration approaches.

### ðŸ–¼ï¸ Modal-View Widget (Recommended)

Embedded modal payment interface displayed on top of your website.

**Typical use cases:**
- E-commerce checkout
- SaaS subscriptions
- On-site payments

**High-level flow:**
1. User clicks CryptumPay button on frontend
2. Widget triggers `onCreateOrder` callback
3. Frontend calls your backend
4. Backend creates an order via SDK
5. Backend returns **CryptumPay Order ID**
6. Widget displays payment modal
7. User completes payment
8. Order status becomes `PAID`
9. Widget triggers `onFinishOrder`

---

### ðŸ”— Direct Payment Links

Hosted CryptumPay payment page accessed via URL.

**Typical use cases:**
- Email invoices
- Messenger payments (Telegram, WhatsApp)
- Manual payments
- Testing and development

---

## Creating an Order

```ts
const response = await client.createOrder({
  title: 'Order #12345',
  description: 'Payment for order',
  fiatAmount: '99.99',
  fiatCurrency: 'usd',
  projectDataOrderId: 'order-12345',
  projectDataUserEmail: 'customer@example.com',
  url: 'https://yoursite.com/orders/12345',
});
```

### Order creation parameters

| Field | Required | Description |
|------|---------|-------------|
| `title` | âœ… | Short order title |
| `description` | âœ… | Order description |
| `fiatAmount` | âœ… | Amount in fiat currency |
| `fiatCurrency` | âœ… | Fiat currency (`USD`, `EUR`, case-insensitive) |
| `projectDataOrderId` | âŒ | Merchant internal order ID |
| `projectDataUserEmail` | âŒ | Customer email |
| `projectDataUserId` | âŒ | Customer ID |
| `projectDataMeta` | âŒ | Custom metadata |
| `url` | âŒ | Redirect URL after payment |

> ðŸ’¡ Only the first four fields affect the payment amount.

---

## Modal-View Widget â€“ Backend Example

```ts
fastify.post('/api/payments/create', async (request, reply) => {
  const response = await cryptumPay.createOrder({
    title: `Order #${request.body.orderId}`,
    description: 'Payment',
    fiatAmount: request.body.amount,
    fiatCurrency: request.body.currency,
    projectDataOrderId: request.body.orderId,
    projectDataUserEmail: request.body.userEmail,
  });

  if (response.errorObject) {
    return reply.status(response.errorObject.httpCode).send(response.errorObject);
  }

  return reply.send({
    id: response.data.id, // CryptumPay Order ID
  });
});
```

---

## Direct Payment Link Example

```ts
const response = await client.createOrder({...});

const paymentUrl = `https://pay.cryptumpay.com/m/${response.data.id}`;
```

---

## Retrieving an Order

```ts
const response = await client.getOrder(orderId);
```

---

## Order Lifecycle and Statuses

| Status | Code | Description |
|------|------|-------------|
| `IN_PROGRESS` | 0 | Order created, waiting for user action |
| `UNDER_REVIEW` | 1 | Payment under review |
| `CANCELED` | 2 | Order canceled or expired |
| `PAID` | 3 | Payment successfully completed |

- Order is considered paid **only when status is `PAID`**
- One order = one payment
- Payment addresses are single-use
- Orders expire at `expiresAt`

---

## Payment Confirmation

You may:
- Poll order status using `getOrder`
- Receive webhook notifications

Webhooks are optional and configured in the merchant console.

---

## Error Handling

- `httpCode` always matches HTTP status
- Partial success states do not exist
- Requests can be safely retried

```ts
if (response.errorObject) {
  console.error(response.errorObject);
}
```

Full error list is available in the documentation.

---

## Environment Variables

```env
CRYPTUMPAY_API_KEY=your_api_key
CRYPTUMPAY_API_SECRET=your_api_secret
```

---

## API Methods

| Method | Description |
|--------|-------------|
| `createOrder(params)` | Create a new order |
| `getOrder(orderId)` | Retrieve order details |

---

## Security Notice

- SDK is **server-side only**
- Never expose API keys
- Validate all incoming data

---

## Documentation

- API Docs: https://docs.cryptumpay.com
- Merchant Console: https://console.cryptumpay.com

---

## Disclaimer

This SDK is provided "as is". CryptumPay is not responsible for losses caused by improper usage or infrastructure misconfiguration.

---

## License

MIT Â© CryptumPay

